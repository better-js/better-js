import{_ as s,c as a,o as i,V as n}from"./chunks/framework.__fMkWnK.js";const b=JSON.parse('{"title":"更新文档","description":"","frontmatter":{},"headers":[],"relativePath":"guide/mongodb/文档更新操作.md","filePath":"guide/mongodb/文档更新操作.md","lastUpdated":1733062151000}'),e={name:"guide/mongodb/文档更新操作.md"},l=n(`<h1 id="更新文档" tabindex="-1">更新文档 <a class="header-anchor" href="#更新文档" aria-label="Permalink to &quot;更新文档&quot;">​</a></h1><p>更新操作用于修改集合中的现有文档，MongoDB 提供了三个更新集合中文档的方法：<code>updateOne()</code> 、<code>updateMany()</code> 和 <code>replaceOne()</code>。</p><p>在 MongoDB 中，更新操作针对的是单个集合。</p><p>MongoDB 提供了更新操作符 <code>$set</code> 来修改字段值。</p><h2 id="更新单个文档" tabindex="-1">更新单个文档 <a class="header-anchor" href="#更新单个文档" aria-label="Permalink to &quot;更新单个文档&quot;">​</a></h2><p>使用 <code>db.collection.updateOne()</code> 方法可以更新集合中符合条件的第一条文档。</p><div class="tip custom-block"><p class="custom-block-title">例子</p><p>要更新 <code>matu.users</code> 集合中的第一个文档，其中 <code>name</code> 等于 <code>Dancy</code></p><ul><li>将 <code>age</code> 字段值修改为 30</li><li>记录当前修改时间</li></ul><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> matu</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.users.updateOne(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Dancy&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		$set: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			age:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NumberInt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		$current: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			lastUpdated:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div><h2 id="更新多个文档" tabindex="-1">更新多个文档 <a class="header-anchor" href="#更新多个文档" aria-label="Permalink to &quot;更新多个文档&quot;">​</a></h2><p>使用 <code>db.collection.updateMany()</code> 方法可以更新集合中所有符合条件的文档。</p><div class="tip custom-block"><p class="custom-block-title">例子</p><p>要更新 <code>matu.users</code> 集合中所有 <code>age</code> 小于 30 的文档</p><ul><li>将 <code>gender</code> 改为 boy</li><li>记录当前修改时间</li></ul><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> matu</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.users.updateOne(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		age:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			$lt: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		$set: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			gender:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;boy&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		},</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		$current: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			lastUpdated:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div><h2 id="替换文档" tabindex="-1">替换文档 <a class="header-anchor" href="#替换文档" aria-label="Permalink to &quot;替换文档&quot;">​</a></h2><p>使用 <code>replaceOne()</code> 方法可以用新的文档替换符合条件的第一条文档。</p><div class="info custom-block"><p class="custom-block-title">例子</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">use</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> users</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.users.replaceOne(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Dancy&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Dancy&quot;, age: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, email: &quot;codebetter@163.com&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><h2 id="其它" tabindex="-1">其它 <a class="header-anchor" href="#其它" aria-label="Permalink to &quot;其它&quot;">​</a></h2><h4 id="覆盖的修改" tabindex="-1">覆盖的修改 <a class="header-anchor" href="#覆盖的修改" aria-label="Permalink to &quot;覆盖的修改&quot;">​</a></h4><p>如果我们想修改<code>_id</code> 为 1 的记录，名称为 <code>wangwu</code></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.集合名称.updateOne(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;}, {name: &quot;wangwu&quot;}, options</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行完之后，我们会发现，这条文档除了name字段，其它字段都不见了</p><h4 id="局部修改" tabindex="-1">局部修改 <a class="header-anchor" href="#局部修改" aria-label="Permalink to &quot;局部修改&quot;">​</a></h4><p>为了解决上面的问题，我们需要使用修改器 <code>$set</code> 来实现，命令如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.集合名称.updateOne(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;}, {</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{name: &quot;wangwu&quot;}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="批量的修改" tabindex="-1">批量的修改 <a class="header-anchor" href="#批量的修改" aria-label="Permalink to &quot;批量的修改&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.集合名称.update(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;}, {</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{name: &quot;wangwu&quot;}},{multi: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果不加后面的参数 <code>{multi: true}</code>，则只更新符合条件的第一条记录</p><h4 id="列值增长的修改" tabindex="-1">列值增长的修改 <a class="header-anchor" href="#列值增长的修改" aria-label="Permalink to &quot;列值增长的修改&quot;">​</a></h4><p>如果我们想实现对某列在原有值的基础上进行增加或减少，可以使用 <code>$inc</code> 运算符来实现</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">db.集合名称.updateOne(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1&quot;}, {</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$inc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:{name: &quot;wangwu&quot;}}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,27),p=[l];function t(h,r,d,k,c,o){return i(),a("div",null,p)}const E=s(e,[["render",t]]);export{b as __pageData,E as default};
